(function(e){e.dateRangePickerLanguages={cn:{selected:"已选择:",day:"天",days:"天",apply:"确定","week-1":"一","week-2":"二","week-3":"三","week-4":"四","week-5":"五","week-6":"六","week-7":"日","month-name":["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],shortcuts:"快捷选择",past:"过去",following:"将来",previous:"&nbsp;&nbsp;&nbsp;","prev-week":"上周","prev-month":"上个月","prev-year":"去年",next:"&nbsp;&nbsp;&nbsp;","next-week":"下周","next-month":"下个月","next-year":"明年","less-than":"所选日期范围不能大于%d天","more-than":"所选日期范围不能小于%d天","default-more":"请选择大于%d天的日期范围","default-less":"请选择小于%d天的日期范围","default-range":"请选择%d天到%d天的日期范围","default-single":"请选择一个日期","default-default":"请选择一个日期范围"},en:{selected:"Selected:",day:"Day",days:"Days",apply:"Close","week-1":"MO","week-2":"TU","week-3":"WE","week-4":"TH","week-5":"FR","week-6":"SA","week-7":"SU","month-name":["JANUARY","FEBRUARY","MARCH","APRIL","MAY","JUNE","JULY","AUGUST","SEPTEMBER","OCTOBER","NOVEMBER","DECEMBER"],shortcuts:"Shortcuts",past:"Past",following:"Following",previous:"Previous","prev-week":"Week","prev-month":"Month","prev-year":"Year",next:"Next","next-week":"Week","next-month":"Month","next-year":"Year","less-than":"Date range should not be more than %d days","more-than":"Date range should not be less than %d days","default-more":"Please select a date range longer than %d days","default-single":"Please select a date","default-less":"Please select a date range less than %d days","default-range":"Please select a date range between %d and %d days","default-default":"Please select a date range"}};if(window["moment"]===undefined){if(window["console"]&&console["warn"])console.warn("Please import moment.js before daterangepicker.js");return}e.fn.dateRangePicker=function(t){function u(){var n=this;if(e(this).data("date-picker-opened")){C();return}e(this).data("date-picker-opened",true);r=_().hide();e(t.container).append(r);if(!t.inline){a()}else{r.css({position:"static"})}if(t.alwaysOpen){r.find(".apply-btn").hide()}var s=new Date;if(t.startDate&&k(s,t.startDate)<0)s=moment(t.startDate).toDate();if(t.endDate&&k(A(s),t.endDate)>0)s=O(moment(t.endDate).toDate());E(s,"month1");E(A(s),"month2");if(t.time.enabled){if(t.startDate&&t.endDate||t.start&&t.end){S(moment(t.start||t.startDate).toDate(),"time1");S(moment(t.end||t.endDate).toDate(),"time2")}else{S(s,"time1");S(s,"time2")}}var o="";if(t.singleDate)o=F("default-single");else if(t.minDays&&t.maxDays)o=F("default-range");else if(t.minDays)o=F("default-more");else if(t.maxDays)o=F("default-less");else o=F("default-default");r.find(".default-top").html(o.replace(/\%d/,t.minDays).replace(/\%d/,t.maxDays));setTimeout(function(){i=true},0);r.click(function(e){e.stopPropagation()});e(document).bind("click.datepicker",C);r.find(".next").click(function(){var n=e(this).parents("table").hasClass("month2");var r=n?t.month2:t.month1;r=A(r);if(!t.singleDate&&!n&&k(r,t.month2)>=0)return;E(r,n?"month2":"month1");N()});r.find(".prev").click(function(){var n=e(this).parents("table").hasClass("month2");var r=n?t.month2:t.month1;r=O(r);if(n&&k(r,t.month1)<=0)return;E(r,n?"month2":"month1");N()});r.bind("click",function(t){if(e(t.target).hasClass("day")){v(e(t.target))}});r.attr("unselectable","on").css("user-select","none").bind("selectstart",function(e){e.preventDefault();return false});r.find(".apply-btn").click(function(){C();var r=T(new Date(t.start))+t.separator+T(new Date(t.end));e(n).trigger("datepicker-apply",{value:r,date1:new Date(t.start),date2:new Date(t.end)})});r.find("[shortcut]").click(function(){var n=e(this).attr("shortcut");var r=new Date,i=false;if(n.indexOf("day")!=-1){var s=parseInt(n.split(",",2)[1],10);i=new Date((new Date).getTime()+864e5*s);r=new Date(r.getTime()+864e5*(s>0?1:-1))}else if(n.indexOf("week")!=-1){var o=n.indexOf("prev,")!=-1?-1:1;if(o==1)var u=t.startOfWeek=="monday"?1:0;else var u=t.startOfWeek=="monday"?0:6;r=new Date(r.getTime()-864e5);while(r.getDay()!=u)r=new Date(r.getTime()+o*864e5);i=new Date(r.getTime()+o*864e5*6)}else if(n.indexOf("month")!=-1){var o=n.indexOf("prev,")!=-1?-1:1;if(o==1)i=A(r);else i=O(r);i.setDate(1);r=A(i);r.setDate(1);r=new Date(r.getTime()-864e5)}else if(n.indexOf("year")!=-1){var o=n.indexOf("prev,")!=-1?-1:1;i=new Date;i.setFullYear(r.getFullYear()+o);i.setMonth(0);i.setDate(1);r.setFullYear(r.getFullYear()+o);r.setMonth(11);r.setDate(31)}else if(n=="custom"){var a=e(this).html();if(t.customShortcuts&&t.customShortcuts.length>0){for(var f=0;f<t.customShortcuts.length;f++){var l=t.customShortcuts[f];if(l.name==a){var c=[];c=l["dates"].call();if(c&&c.length==2){i=c[0];r=c[1]}if(c&&c.length==1){movetodate=c[0];E(movetodate,"month1");E(A(movetodate),"month2");N()}break}}}}if(i&&r){b(i,r);g()}});r.find(".time1 input[type=range]").bind("change mousemove",function(t){var n=t.target,r=n.name=="hour"?e(n).val().replace(/^(\d{1})$/,"0$1"):undefined,i=n.name=="minute"?e(n).val().replace(/^(\d{1})$/,"0$1"):undefined;p("time1",r,i)});r.find(".time2 input[type=range]").bind("change mousemove",function(t){var n=t.target,r=n.name=="hour"?e(n).val().replace(/^(\d{1})$/,"0$1"):undefined,i=n.name=="minute"?e(n).val().replace(/^(\d{1})$/,"0$1"):undefined;p("time2",r,i)})}function a(){if(!t.inline){var n=e(s).offset();if(n.left<460){r.css({top:n.top+e(s).outerHeight()+parseInt(e("body").css("border-top")||0,10),left:n.left})}else{r.css({top:n.top+e(s).outerHeight()+parseInt(e("body").css("border-top")||0,10),left:n.left+e(s).width()-r.width()-16})}}}function f(e){a();var n=t.getValue.call(o);var i=n?n.split(t.separator):"";if(i&&i.length>=2){var s=t.format;if(s.match(/Do/)){s=s.replace(/Do/,"D");i[0]=i[0].replace(/(\d+)(th|nd|st)/,"$1");i[1]=i[1].replace(/(\d+)(th|nd|st)/,"$1")}b(moment(i[0],s).toDate(),moment(i[1],s).toDate())}r.slideDown(e)}function l(e,t){r.find("."+e+" input[type=range].hour-range").val(moment(t).hours());r.find("."+e+" input[type=range].minute-range").val(moment(t).minutes());p(e,moment(t).format("HH"),moment(t).format("mm"))}function c(e,n){t[e]=parseInt(moment(parseInt(n)).startOf("day").add("h",moment(t[e+"Time"]).format("HH")).add("m",moment(t[e+"Time"]).format("mm")).valueOf())}function h(){l("time1",t.start);l("time2",t.end)}function p(e,n,i){function s(e,r){var s=r.format("HH"),o=r.format("mm");t[e]=r.startOf("day").add("h",n||s).add("m",i||o).valueOf()}n&&r.find("."+e+" .hour-val").text(n);i&&r.find("."+e+" .minute-val").text(i);switch(e){case"time1":if(t.start){s("start",moment(t.start))}s("startTime",moment(t.startTime||moment().valueOf()));break;case"time2":if(t.end){s("end",moment(t.end))}s("endTime",moment(t.endTime||moment().valueOf()));break}g();y();w()}function d(){t.start=false;t.end=false;r.find(".day.checked").removeClass("checked");t.setValue.call(o,"");g();y();w()}function v(e){if(e.hasClass("invalid"))return;var n=e.attr("time");e.addClass("checked");if(t.singleDate){t.start=n;t.end=false;if(t.time.enabled){c("start",t.start)}}else if(t.batchMode==="week"){if(t.startOfWeek==="monday"){t.start=moment(parseInt(n)).startOf("isoweek").valueOf();t.end=moment(parseInt(n)).endOf("isoweek").valueOf()}else{t.end=moment(parseInt(n)).endOf("week").valueOf();t.start=moment(parseInt(n)).startOf("week").valueOf()}}else if(t.batchMode==="month"){t.start=moment(parseInt(n)).startOf("month").valueOf();t.end=moment(parseInt(n)).endOf("month").valueOf()}else if(t.start&&t.end||!t.start&&!t.end){t.start=n;t.end=false;if(t.time.enabled){c("start",t.start)}}else if(t.start){t.end=n;if(t.time.enabled){c("end",t.end)}}if(!t.singleDate&&t.start&&t.end&&t.start>t.end){var r=t.end;t.end=t.start;t.start=r;if(t.time.enabled){h()}}t.start=parseInt(t.start);t.end=parseInt(t.end);g();y();w();m()}function m(){if(t.singleDate===true){if(i&&t.start){if(t.autoClose)C()}}else{if(i&&t.start&&t.end){if(t.autoClose)C()}}}function g(){var e=Math.ceil((t.end-t.start)/864e5)+1;if(t.singleDate){if(t.start&&!t.end)r.find(".drp_top-bar").removeClass("error").addClass("normal");else r.find(".drp_top-bar").removeClass("error").removeClass("normal")}else if(t.maxDays&&e>t.maxDays){t.start=false;t.end=false;r.find(".day").removeClass("checked");r.find(".drp_top-bar").removeClass("normal").addClass("error").find(".error-top").html(F("less-than").replace("%d",t.maxDays))}else if(t.minDays&&e<t.minDays){t.start=false;t.end=false;r.find(".day").removeClass("checked");r.find(".drp_top-bar").removeClass("normal").addClass("error").find(".error-top").html(F("more-than").replace("%d",t.minDays))}else{if(t.start||t.end)r.find(".drp_top-bar").removeClass("error").addClass("normal");else r.find(".drp_top-bar").removeClass("error").removeClass("normal")}if(t.singleDate&&t.start&&!t.end||!t.singleDate&&t.start&&t.end){r.find(".apply-btn").removeClass("disabled")}else{r.find(".apply-btn").addClass("disabled")}if(t.batchMode){if(t.start&&t.startDate&&L(t.start,t.startDate)<0||t.end&&t.endDate&&L(t.end,t.endDate)>0){t.start=false;t.end=false;r.find(".day").removeClass("checked")}}}function y(){r.find(".start-day").html("...");r.find(".end-day").html("...");r.find(".selected-days").hide();if(t.start){r.find(".start-day").html(T(new Date(parseInt(t.start))))}if(t.end){r.find(".end-day").html(T(new Date(parseInt(t.end))))}if(t.start&&t.singleDate){r.find(".apply-btn").removeClass("disabled");var n=T(new Date(t.start));t.setValue.call(o,n,T(new Date(t.start)),T(new Date(t.end)));if(i){e(s).trigger("datepicker-change",{value:n,date1:new Date(t.start)})}}else if(t.start&&t.end){r.find(".selected-days").show().find(".selected-days-num").html(Math.round((t.end-t.start)/864e5)+1);r.find(".apply-btn").removeClass("disabled");var n=T(new Date(t.start))+t.separator+T(new Date(t.end));t.setValue.call(o,n,T(new Date(t.start)),T(new Date(t.end)));if(i){e(s).trigger("datepicker-change",{value:n,date1:new Date(t.start),date2:new Date(t.end)})}}else{r.find(".apply-btn").addClass("disabled")}}function b(e,n){if(e.getTime()>n.getTime()){var r=n;n=e;e=r;r=null}var i=true;if(t.startDate&&L(e,t.startDate)<0)i=false;if(t.endDate&&L(n,t.endDate)>0)i=false;if(!i){E(t.startDate,"month1");E(A(t.startDate),"month2");N();return}t.start=e.getTime();t.end=n.getTime();if(k(e,n)==0){n=A(e)}if(t.time.enabled){l("time1",e);l("time2",n)}E(e,"month1");E(n,"month2");N();y();m()}function w(){if(!t.start&&!t.end)return;r.find(".day").each(function(){var n=parseInt(e(this).attr("time")),r=t.start,i=t.end;if(t.time.enabled){n=moment(n).startOf("day").valueOf();r=moment(r||moment().valueOf()).startOf("day").valueOf();i=moment(i||moment().valueOf()).startOf("day").valueOf()}if(t.start&&t.end&&i>=n&&r<=n||t.start&&!t.end&&r==n){e(this).addClass("checked")}else{e(this).removeClass("checked")}})}function E(e,n){e=moment(e).toDate();var i=x(e.getMonth());r.find("."+n+" .month-name").html(i+" "+e.getFullYear());r.find("."+n+" tbody").html(B(e));t[n]=e}function S(e,t){r.find("."+t).append(M());l(t,e)}function x(e){return F("month-name")[e]}function T(e){return moment(e).format(t.format)}function N(){w();var e=parseInt(moment(t.month1).format("YYYYMM"));var n=parseInt(moment(t.month2).format("YYYYMM"));var i=Math.abs(e-n);var s=i>1&&i!=89;if(s)r.find(".gap").show();else r.find(".gap").hide()}function C(){if(t.alwaysOpen)return;e(r).slideUp(200,function(){e(s).data("date-picker-opened",false)});e(s).trigger("datepicker-close")}function k(e,t){var n=parseInt(moment(e).format("YYYYMM"))-parseInt(moment(t).format("YYYYMM"));if(n>0)return 1;if(n==0)return 0;return-1}function L(e,t){var n=parseInt(moment(e).format("YYYYMMDD"))-parseInt(moment(t).format("YYYYMMDD"));if(n>0)return 1;if(n==0)return 0;return-1}function A(e){e=moment(e).toDate();var t=e.getMonth();while(e.getMonth()==t)e=new Date(e.getTime()+864e5);return e}function O(e){e=moment(e).toDate();var t=e.getMonth();while(e.getMonth()==t)e=new Date(e.getTime()-864e5);return e}function M(){var e="<div>"+'<span>Time: <span class="hour-val">00</span>:<span class="minute-val">00</span></span>'+"</div>"+'<div class="hour">'+'<label>Hour: <input type="range" class="hour-range" name="hour" min="0" max="23"></label>'+"</div>"+'<div class="minute">'+'<label>Minute: <input type="range" class="minute-range" name="minute" min="0" max="59"></label>'+"</div>";return e}function _(){var n='<div class="date-picker-wrapper';if(t.singleDate)n+=" single-date";if(!t.showShortcuts)n+=" no-shortcuts ";n+='">'+'<div class="drp_top-bar">         <div class="normal-top">            <span style="color:#333">'+F("selected")+' </span> <b class="start-day">...</b>';if(!t.singleDate){n+=' <span class="separator-day">'+t.separator+'</span> <b class="end-day">...</b> <i class="selected-days">(<span class="selected-days-num">3</span> '+F("days")+")</i>"}n+='</div>         <div class="error-top">error</div>          <div class="default-top">default</div>          <input type="button" class="apply-btn disabled '+D()+'" value="'+F("apply")+'" />       </div>'+'<div class="month-wrapper">'+'<table class="month1" cellspacing="0" border="0" cellpadding="0"><thead><tr class="caption"><th style="width:27px;"><span class="prev">&lt;</span></th><th colspan="5" class="month-name">January, 2011</th><th style="width:27px;"><span class="next">&gt;</span></th></tr><tr class="week-name">'+P()+"</thead><tbody></tbody></table>";if(!t.singleDate){n+='<div class="gap">'+H()+"</div>"+'<table class="month2" cellspacing="0" border="0" cellpadding="0"><thead><tr class="caption"><th style="width:27px;"><span class="prev">&lt;</span></th><th colspan="5" class="month-name">January, 2011</th><th style="width:27px;"><span class="next">&gt;</span></th></tr><tr class="week-name">'+P()+"</thead><tbody></tbody></table>"}n+='<div style="clear:both;height:0;font-size:0;"></div>'+'<div class="time">'+'<div class="time1"></div>';if(!t.singleDate){n+='<div class="time2"></div>'}n+="</div>"+'<div style="clear:both;height:0;font-size:0;"></div>'+"</div>";if(t.showShortcuts){n+='<div class="footer"><b>'+F("shortcuts")+"</b>";var r=t.shortcuts;if(r){if(r["prev-days"]&&r["prev-days"].length>0){n+='&nbsp;<span class="prev-days">'+F("past");for(var i=0;i<r["prev-days"].length;i++){var s=r["prev-days"][i];s+=r["prev-days"][i]>1?F("days"):F("day");n+=' <a href="javascript:;" shortcut="day,-'+r["prev-days"][i]+'">'+s+"</a>"}n+="</span>"}if(r["next-days"]&&r["next-days"].length>0){n+='&nbsp;<span class="next-days">'+F("following");for(var i=0;i<r["next-days"].length;i++){var s=r["next-days"][i];s+=r["next-days"][i]>1?F("days"):F("day");n+=' <a href="javascript:;" shortcut="day,'+r["next-days"][i]+'">'+s+"</a>"}n+="</span>"}if(r["prev"]&&r["prev"].length>0){n+='&nbsp;<span class="prev-buttons">'+F("previous");for(var i=0;i<r["prev"].length;i++){var s=F("prev-"+r["prev"][i]);n+=' <a href="javascript:;" shortcut="prev,'+r["prev"][i]+'">'+s+"</a>"}n+="</span>"}if(r["next"]&&r["next"].length>0){n+='&nbsp;<span class="next-buttons">'+F("next");for(var i=0;i<r["next"].length;i++){var s=F("next-"+r["next"][i]);n+=' <a href="javascript:;" shortcut="next,'+r["next"][i]+'">'+s+"</a>"}n+="</span>"}}if(t.customShortcuts){for(var i=0;i<t.customShortcuts.length;i++){var o=t.customShortcuts[i];n+='&nbsp;<span class="custom-shortcut"><a href="javascript:;" shortcut="custom">'+o.name+"</a></span>"}}n+="</div>"}n+="</div>";return e(n)}function D(){if(t.autoClose===true){return"hide"}return""}function P(){if(t.startOfWeek=="monday"){return"<th>"+F("week-1")+"</th>          <th>"+F("week-2")+"</th>          <th>"+F("week-3")+"</th>          <th>"+F("week-4")+"</th>          <th>"+F("week-5")+"</th>          <th>"+F("week-6")+"</th>          <th>"+F("week-7")+"</th>"}else{return"<th>"+F("week-7")+"</th>          <th>"+F("week-1")+"</th>          <th>"+F("week-2")+"</th>          <th>"+F("week-3")+"</th>          <th>"+F("week-4")+"</th>          <th>"+F("week-5")+"</th>          <th>"+F("week-6")+"</th>"}}function H(){var e=['<div class="gap-top-mask"></div><div class="gap-bottom-mask"></div><div class="gap-lines">'];for(var t=0;t<20;t++){e.push('<div class="gap-line">         <div class="gap-1"></div>         <div class="gap-2"></div>         <div class="gap-3"></div>       </div>')}e.push("</div>");return e.join("")}function B(e){var n=[];e.setDate(1);var r=new Date(e.getTime()-864e5);var i=new Date;var s=e.getDay();if(s==0&&t.startOfWeek=="monday"){s=7}if(s>0){for(var o=s;o>0;o--){var u=new Date(e.getTime()-864e5*o);var a=true;if(t.startDate&&L(u,t.startDate)<0)a=false;if(t.endDate&&L(u,t.endDate)>0)a=false;n.push({type:"lastMonth",day:u.getDate(),time:u.getTime(),valid:a})}}var f=e.getMonth();for(var o=0;o<40;o++){var l=moment(e).add("days",o).toDate();var a=true;if(t.startDate&&L(l,t.startDate)<0)a=false;if(t.endDate&&L(l,t.endDate)>0)a=false;n.push({type:l.getMonth()==f?"toMonth":"nextMonth",day:l.getDate(),time:l.getTime(),valid:a})}var c=[];for(var h=0;h<6;h++){if(n[h*7].type=="nextMonth")break;c.push("<tr>");for(var u=0;u<7;u++){var p=t.startOfWeek=="monday"?u+1:u;var l=n[h*7+p];var d=moment(l.time).format("L")==moment(i).format("L");l.extraClass="";l.tooltip="";if(t.beforeShowDay&&typeof t.beforeShowDay=="function"){var v=t.beforeShowDay(moment(l.time).toDate());l.valid=v[0];l.extraClass=v[1]||"";l.tooltip=v[2]||"";if(l.tooltip!="")l.extraClass+=" has-tooltip "}c.push('<td><div time="'+l.time+'" title="'+l.tooltip+'" class="day '+l.type+" "+l.extraClass+" "+(l.valid?"valid":"invalid")+" "+(d?"real-today":"")+'">'+l.day+"</div></td>")}c.push("</tr>")}return c.join("")}function j(){if(t.language=="auto"){var n=navigator.language?navigator.language:navigator.browserLanguage;if(!n)return e.dateRangePickerLanguages["en"];var n=n.toLowerCase();for(var r in e.dateRangePickerLanguages){if(n.indexOf(r)!=-1){return e.dateRangePickerLanguages[r]}}return e.dateRangePickerLanguages["en"]}else if(t.language&&t.language in e.dateRangePickerLanguages){return e.dateRangePickerLanguages[t.language]}else{return e.dateRangePickerLanguages["en"]}}function F(e){return e in n?n[e]:e}if(!t)t={};t=e.extend(true,{autoClose:false,format:"YYYY-MM-DD",separator:" to ",language:"auto",startOfWeek:"sunday",getValue:function(){return e(this).val()},setValue:function(t){e(this).val(t)},startDate:false,endDate:false,time:{enabled:false},minDays:0,maxDays:0,showShortcuts:true,shortcuts:{"next-days":[3,5,7],next:["week","month","year"]},customShortcuts:[],inline:false,container:"body",alwaysOpen:false,singleDate:false,batchMode:false},t);t.start=false;t.end=false;if(t.startDate&&typeof t.startDate=="string")t.startDate=moment(t.startDate,t.format).toDate();if(t.endDate&&typeof t.endDate=="string")t.endDate=moment(t.endDate,t.format).toDate();var n=j();var r;var i=false;var s=this;var o=e(s).get(0);e(this).unbind(".datepicker").bind("click.datepicker",function(e){e.stopPropagation();f(200)});u.call(this);if(t.alwaysOpen){f(0)}e(this).data("dateRangePicker",{setDateRange:function(e,n){if(typeof e=="string"&&typeof n=="string"){e=moment(e,t.format).toDate();n=moment(n,t.format).toDate()}b(e,n)},clear:d,close:C,open:f,destroy:function(){e(s).unbind(".datepicker");e(s).data("dateRangePicker","");r.remove();e(window).unbind("resize.datepicker",a);e(document).unbind("click.datepicker",C)}});e(window).bind("resize.datepicker",a);return this}})(jQuery)
